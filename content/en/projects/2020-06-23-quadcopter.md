---
title: Quadcopter
description: >-
  Somewhere around the late 2017 I got the idea that flying a quadcopter could be fun. Not a toy-copter, but a real powerful FPV-quadcopter with a camera that transmits live footage from the copter. And of course simply buying a quadcopter wasn't an option, so I decided to build one myself. I would plan and 3D-print the frame myself and program the brain of the device, so called Flight controller. Surprisingly I actually was able to make a copter that was flyable. (However, later I ended up buying a carbon fiber frame and a better flight controller that I didn't code myself, but more about that later.)
HTMLdescription: >-
  Somewhere around the late 2017 I got the idea that flying a quadcopter could be fun. So I began building one myself with my 3D-printer. I also decided to make the code for the brain of the quadcopter, the flight controller.
singlePageContent: >-
  Because I am a stupid human being, I didn't take any pictures of the working quadcopter. (Back then I wasn't yet a typical youngster spending all their time in social media, so I didn't have Snapchat and didn't take pictures of all I saw.) What I still have are the 3D-models of the copter, with which I can show what the copter roughly looked like. <img style="float: right; width: 500px" src="/img/quadcopter-model.png" alt="3D-model of the quadcopter"> It was pretty small in size, the distance from the center of one motor to the opposite corner motor was about 150 mm. The diameter of the propellers was 3 inches. The tall thingy on the top protected the electronics, camera and the video transmitter. I am very stingy, so most of the parts were the cheapest I could get from Hobbyking. I guess I also thought I would save money if I printed the frame and programmed the brain of the machine myself. (The "brain" was once again based on an Atmega328P-microcontroller used in many Arduino-boards. At some point I used Arduino Pro mini, but in the end I ended up using the microcontroller without any Arduino-platform. No difference really, it's the same microcontroller anyways.)   


  So I ordered all the parts needed for the copter and started putting together a working device. Not a whole lot of components was needed: Flight controller (in this case Atmega328P), 4xESC (Electronic Speed Controller, they are needed to control the brushless motors), a radio receiver and a gyroscope. As a gyroscope I used a MPU6050-module, that also has an accelerometer. A gyroscope measures the spinning of the copter in 3 axes, but it only tells the speed of rotation, and not the absolute orientation of the copter. This is enough, if you plan on using the device in [Acro-mode](https://oscarliang.com/rate-acro-horizon-flight-mode-level/), which means that the orientation of the copter stays the same, if you don't touch your controller. With an accelerometer you can calculate the absolute orientation of the copter using the downward facing force of gravity. I tried to implement Self-level-mode with the accelerometer, so that the copter would level itself if I let go of the controller's sticks. However I failed to make that work. I think the vibration of the motors made the reading of the accelerometer too unstable, and so I couldn't make things work. But I was happy with acro-mode, because in every Youtube-video I watched people flew with acro-mode and made cool tricks with their copters.


  In addition to the absolutely necessary parts I got a buzzer, so the copter could tell me useful information via bleeps. The noise also makes the copter easier to find if it falls uncontrollably in the middle of a field. (It is important to always fly your copter far from others.) I also bought a Bluetooth module, so that I can easily and wirelessly change parameters that affect the copters flight.


  About the programming: I didn't start making the software without any guides. For example Joop Brokking's [Youtube-videos](https://www.youtube.com/playlist?list=PL0K4VDicBzsibZqfa42DVxC8CGCMB7G2G) helped me a lot. In those videos he builds very similar device. I didn't copy code from him, but his videos helped me understand what I need for a working quadcopter and how I could implement these features. I have to say that I am maybe a bit proud of my code, just because the copter actually flew (not perfectly, but it flew). Also, I made the code so that you can configure and change things easily with a config.h file. Inspiration for this was the similar config-file in Marlin-firmware used by my 3D-printer. <video style="float: left; width: 400px;" muted controls alt="A video of the quadcopter flying in a field"><source src="/img/quadcopter-video.webm" type="video/webm"><source src="/img/quadcopter-video.mp4" type="video/mp4">The video isn't supported by your browser.</video>


  The quality of the video you get from the camera is definitely not mind-blowing. That's probably partly because the camera vibrates a bit because of the motors. The main reason still is that the video must be transmitted with as small delay as possible. That's why we must cut down on the quality. The video is transmitted at 5.8 GHz and analoguely as far as I know.


  The working principle of the copter and the code: The gyroscope tells us the copter's spinning speed in the x-, y- and x-axis. The radio receiver tells us what we want these values to be. Then we do some math, and the flight controller talks with the ESCs, that then adjust the motors' speed. In this case "some math" means the [PID-controller](https://www.youtube.com/watch?v=JBvnB0279-Q). The link takes you to Joop Brokking's video that helped me understand PID-controller well enough so that I was able to program one myself. (Surely I also watched other videos and read tutorials.) And the video actually tells you how to program a PID-controller. I used that as a guideline but didn't directly copy code. <div class=imgWithCaption style="float: right; width: 600px;"><img id=quadcopter-old src="/img/quadcopter-old-small.jpg" alt="Electronics of the old quadcopter: MPU6050-sensor, Bluetooth-module, socket for the Atmega328P, buzzer and a DC-DC-converter"><p class=caption>All that's left of the 3D-printed copter: MPU6050-sensor, Bluetooth-module, socket for the Atmega328P, buzzer and a DC-DC-converter, that converts the battery's voltage suitable for the microcontroller</p></div>


  Via Bluetooth you could change the PID-controller's P-, I-, and D-coefficients for different axes and also other parameters of the copter. You could also save these to the EEPROM-memory of the microcontroller.


  Writing the software of a quadcopter can be potentially dangerous: The propellers spin quite fast, and if the copter gets out of control because of bad software, with bad luck you can cause even quite severe damage to yourself or others. Of course I tried to make the software as safe as possible, and it has some safety features for example in case the copter loses connection to the radio controller. During the development I had one hazardous situation: Suddenly the motors of the copter started spinning at full speed, and of course I had the propellers connected. I was in my room at the time. Luckily the copter flew under one shelf of mine and the motors calmed down after a while. Had the copter flown to my face for example, the damage would probably not have been very pretty. (The propellers are surprisingly sharp and spin very fast.) I don't precisely remember what caused the problem, but I think it had something to do with reading the signal from the radio receiver. Because of a small error in the code some variable got very strange values almost randomly. Luckily I was able to fix that.


  <div class=imgWithCaption style="float: right; width: 600px;"><img id=quadcopter-new src="/img/quadcopter-new-small.jpg"" alt="The new quadcopter"><p class=caption>The quadcopter as of now</p></div>As you might have noticed, I write about the copter in past tense. There is a reason: The 3D-printed frame broke every time I crashed badly. (And I crashed a lot because I'm not good at flying the thing). Self-written code was good enough to make it fly, but it wasn't very steady. These are the main reasons why I eventually decided to buy a Carbon fiber frame and change to a 32-bit STM32-microcontroller, that didn't run my software but [Betaflight](https://betaflight.com/), which probably has more man-hours behind it compared to my software. After these changes the copter has been much steadier. The only problem is that I lost my motivation to fly the thing. Likely the reason for that is that all the time I was more interested of developing the copter rather than flying it. Also I never learned to fly the copter very well. So I haven't flown with the device in a while, and now I'm thinking should I perhaps try to sell it or will I someday find my lost motivation to fly and develop the copter more.


  [Link to the code](https://github.com/jarvnp/quadcopter)
order: 4
---
