---
title: FM-radio
description: >-
  Once again I was inspired by a [Youtube-video](https://www.youtube.com/watch?v=RqyhvlMKt14) from GreatScott. This time I started making an FM-radio. We did have a completely working FM-radio at home though, but it wasn't in use. So I took it apart and took the speaker elements and antenna that I then used to make a new radio. Clever, right?
HTMLdescription: >-
  Inspired by a Youtube-video I took apart a working radio we had at home, grabbed the speaker elements and antenna from it and then used those to build another radio. Clever, right?
singlePageContent: >-
  So my plan was to build a radio that can be used to listen to FM-channels. I started making the project even though we didn't really have use for a radio at home. We just sometimes listen to games of Porin Ässät. And I did use the parts from the other quite old radio we had at home, which didn't make much sense. I disassembled a working radio and made another radio from the same parts. At least I learned something while making the radio.


  <img id=radio src="/img/radio-small.jpg" style="float: left; width: 500px" alt="DIY wooden radio">Once again the case is that I don't remember all the details of this project. I'll try to dig through my memory and my computer to find as much information as possible. As the radio receiver I used the same module GreatScott used in his video, the TEA5767. I controlled it unsurprisingly with an Atmega328P-microcontroller with commands sent via I2C. The audio signal goes from the radio receiver through digitally controlled potentiometer, an operational amplifier and audio power amplifier to the speakers. I ordered the audio amplifier from China, and it has Bluetooth built-in, so my radio functions also as a BT-speaker. I think I directed the audio signal kind of weirdly from the radio receiver through an Op-Amp to the digital potentiometer and then again through another Op-Amp to the main audio amplifier. I did have a few reasons for this. Firstly, I wanted to be able to change the amplitude of the audio so that the audio volume would be good for the maximum and minimum values of the digital potentiometer. So I connected the first Op-Amp so that I could adjust the amplitude of the signal with a physical potentiometer. The other Op-Amp is just a so called "voltage follower", so it doesn't do change the signal in any ways. It's probably quite useless. I think I used it because I didn't know what's the input impedance of the audio amplifier from China. Had I connected the digital potentiometer directly to the amplifier the signal could maybe have dampened a slight bit, if the input impedance wasn't very high. The Op-Amp on the other hand can supply a bit of current without the amplitude of the signal changing. I don't know if that explanation made any sense, hopefully you understood.<img id=radio-inside src="/img/radio-inside-small.jpg" style="float: left; width: 500px" alt="The radio from the inside. Electronics and wires.">


  The radio also has a battery, which I of course didn't order specifically for this project. I disassembled an old laptop we had laying around at home and took the batteries from it. Then I ordered a module that takes care of the batteries' health. (It makes sure the batteries don't overcharge or overdischarge, and it also has a short circuit protection.)


  Based on the looks and the components it might seem like I copied the entire project straight from Youtube. However that's not the case. For example the digital potentiometer I used (X9C104) is different than the one in the video (probably because it was cheaper). I learned how to use it using its datasheet. Also, I wrote the code myself. Again, I don't have much to say about it, because I don't remember much about how it works. Some time after making the radio I realized that the code probably sucks, because, when using the radio, the program jumps from one function to another without returning anything or getting to the end of the function. This is definitely not good. So, in hindsight, I made the operating system of the radio very poorly.<img id=radio-inside2 src="/img/radio-inside2-small.jpg" style="float: right; width: 400px" alt="Electronics of the radio. X9C104, operational amplifier, Atmega328P, TEA5767 and other components."> I never fixed this problem though, because the radio worked. Of course if this caused problems or someone else than me used the radio I would fix the problem. Now that I'm writing about this I feel really embarrassed, but I am not going to start fixing the code anymore. You learn from your mistakes.


  The radio is far for perfect, and I know that. It's also partly the reason why this radio hasn't been used much. The audio quality isn't marvelous, which is to be expected if you use old speakers snatched from an old radio and stick them in a case without considering the acoustics at all. In addition to that the audio amplifier has one very annoying feature: When you turn on the radio, it makes a buzzing sound. And it's very loud for some reason. You almost want to cover your ears. This is why you pretty much want to avoid turning on the radio.


  **Edit (6.4.2021):**<br>
  I decided to try fix/enhance the radio on my one-week holiday from the army. The reason for this was that there was actually some use for the radio earlier, and it was a bit embarrassing when its sound quality and functionality weren't so impressing. I bought new speaker elements and some acoustic wool, because that's apparently good for the acoustics. I installed the new speakers and did some research on the circuit I had made earlier and found a few pretty bad mistakes.<img id=radio-new src="/img/radio-new-small.jpg" style="float: left; width: 500px" alt="The updated radio">


  The sound goes from the FM-receiver to the operational amplifier, which is set up to be a voltage follower. (I remembered this incorrectly when writing the earlier text.) A DC-offset is added to the sound signal so that the Op-amp, powered straight from the about 12V Li-ion battery, could handle the signal. Even though the negative power pin is connected to ground (0V) and the positive to the battery (12V), it's output can't quite reach those limits, though that depends on the particular OP-amp that's being used. That's why I added a DC-offset of about 6V to the signal. If the peak voltage of the signal is 1V, the signal will oscillate about between 5-7V, which is ok for the Op-amp.


  From the Op-amp the voice connects to the digital potentiometer and from that to the other Op-amp, which is set up to have a small gain so that the maximum and minimum voice levels can be adjusted. There is a problem though. I had connected the potentiometer so that for example, if the signal voltage is 6V and the volume 50%, the potentiometer's output is 3V. So the signal was connected to one of the potentiometer's pins, ground to another and the dampened signal was taken from the central pin. So then the DC-offset is also dampened, which is not good. I started wondering how this ever worked. On small volumes the DC-offset is dampened almost entirely. The op-amp I used was LM358. Now that I studied its datasheet, I noticed that its output can go down to ground, so that's why it worked even though I had connected things a bit stupidly. I still changed the circuit so that instead of ground one of the potentiometers pins was connected to the DC-offset voltage of the signal, so that the DC-offset doesn't disappear.


  Another stupidity: The small gain on the other op-amp amplified also the DC-offset. Not good. This way a relatively small gain is enough to make the signal go to the op-amp's maximum. Again I started wondering how this ever worked. This time I really don't know. Actually at some point I tried using an NE5532-op-amp, because it's supposed to be low-noise. It didn't work, even though the LM358 had worked. Just horrible rattle came out from the speakers. I fixed this problem simply by taking off the amplification of the op-amp. The volume was just fine without any gain. And I also tried if it could work entirely without these op-amps, but the voice volume decreased significantly when I connected the signal directly from the FM-receiver to the potentiometer and then the amplifier. This is probably because of the large resistance of the potentiometer (100 kohm).


  So I fixed these problems and changed the op-amp for an NE5532. These improvements enhanced the audio quality noticeably.


  Then I decided to fix one more great issue: The power-up beep. The sound originates to the Bluetooth-module, that's integrated to the amplifier board. Luckily with some help from the Internet I managed to find a pin on the amplifier module that puts the amplifier to standby-mode when connected to ground. So I could fix the problem by keeping the amplifier in standby mode for about 10s on power-up. That way the Bluetooth module turns on, but the beeping sound doesn't get to the speakers. After this the speakers can be used normally.


  <img id=ne555 src="/img/ne555.png" style="float: right; width: 500px" alt="NE555 schematic">I could easily have connected the microcontroller to this pin and use that for this 10s delay. However I decided to challenge myself a bit. A long time ago I bought several 555-timer circuits that I never used. Now I saw a chance to use them. So I studied a bit how a 555-timer works and eventually I was able to design a circuit that did what I wanted it to do. At power-up the transistor is on, so the standby-pin is pulled low. After about 10s delay the transistor turns off, and the pullup resistor on the pin pulls it high and the amplifier wakes up.


  <img id=radio-new-inside src="/img/radio-new-inside-small.jpg" style="float: left; width: 400px" alt="Updated radio from the inside">In addition to these changes I also switched the buck-converter I used to a 5V voltage regulator, because the regulator's output voltage could apparently be a bit less noisy. Then I just put the speaker back together, added some acoustic wool and was finished. Except I wasn't. There was still annoying amount of noise, but actually the signal was noisiest, when the sound came via Bluetooth. So the problem is the amplifier with an integrated Bluetooth receiver. So I must by a new and hopefully better amplifier. All in all I'm happy with the upgrades I made, because the sound quality from the FM-receiver is much better than before and the new speaker elements also sound much better than the old ones.


  [Link to the code](https://github.com/jarvnp/FM-radio)
order: 5
---
